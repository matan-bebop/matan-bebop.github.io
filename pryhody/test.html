<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF8">
  <title>Тест WASM SWI-Прологу</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body>

<div id="solution"></div>
<br>
<div id="prompt_line" style="display:flex">
  <div style="flex-grow:1">: </div>
  <input type="text" id="input"
	 onkeypress='if(event.key == "Enter") { enter() }'
	 autofocus onfocusout="refocus()"
	 style="width:100%">
</div>
<div id="dummy" style="height:5em">

<script src="swipl-bundle-devel.js"></script>

<script>

var swipl;
var options = { };

const output = document.getElementById("solution");

(async () => {
  swipl = await SWIPL({ arguments: ["-q"] });
  /* await swipl.prolog.consult("pilou-web.qlf"); */
  const query = "memberchk(X, [dupa, pupa]).";
  const firstSolution = swipl.prolog.query(query).once().X;
  output.textContent = firstSolution;
})();

prompt_line = document.getElementByID("prompt_line")
dummy = document.getElementByID("dummy")

input = document.getElementByID("input")

function refocus() { setTimeout(function () { input.focus() }, 0) }

function enter() {
  paragraph(input.value)
  input.value = ""
}

function paragraph(text) {
  const	new_par = document.createElement("p")
  new_par.innerText = ": " + text
  document.body.insertBefore(new_par, prompt_line)
  if(!navigator.userAgent.includes("iPhone")) {
    prompt_line.scrollIntoView(false)
  } else {
    /* fucking iPhone scrolls about 5em before the element when the page is 
       longer than one screen */ 
    dummy.scrollIntoView(false)
  }
}

</script>

</body>
</html>
