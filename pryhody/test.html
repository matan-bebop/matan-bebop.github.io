<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF8">
  <title>Тест WASM SWI-Прологу</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body>

<div id="output"></div>
<div id="prompt_line" style="display:flex">
  <div style="flex-grow:1">: </div>
  <input type="text" id="input"
	 onkeypress='if(event.key == "Enter") { enter() }'
	 autofocus onfocusout="refocus()"
	 style="width:100%">
</div>

<script src="swipl-bundle-devel.js"></script>

<script>

var swipl;
var swipl_options = {
  arguments: ["-q"],
  on_output: function(msg,stream) {
		console.log(msg)
		if (stream == "stdout") { paragraph(msg) }
	     }
};

(async () => {
  swipl = await SWIPL(swipl_options)
  await swipl.prolog.load_scripts()
  await swipl.prolog.consult("pilou-web.qlf")
  /* потрібно зробити ввід для web у repl */
  //await swipl.prolog.query("грати_спочатку.").once()
  swipl.prolog.query("зайти(двір).").once()
})();

const output = document.getElementById("output");
prompt_line = document.getElementById("prompt_line")
input = document.getElementById("input")

function refocus() { setTimeout(function () { input.focus() }, 0) }

function enter() {
  paragraph(": " + input.value)
  input.value = ""
}

/* Fucking iPhone scrolls about 5em before the element when the page is longer
   than one screen */
if(navigator.userAgent.includes("iPhone")) {
  prompt_line.style.paddingBottom = "5em"
}

function paragraph(text) {
  const	new_par = document.createElement("p")
  new_par.innerText = text
  document.body.insertBefore(new_par, prompt_line)
  prompt_line.scrollIntoView(false)
}

</script>


<script type="text/prolog" id="aux.pl">

/* Варʼянти звідси випадають першими за варʼянти з .qlf-файлу, див. процедуру
   завантаження Прологу і його програм. */

web(true).

</script>


<!-- .qlf does not seem to load with load_scripts(), so I load it manually above
<script type="text/prolog" src="pilou-web.qlf"></script>
-->


</body>
</html>
